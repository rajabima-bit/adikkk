<script>
let step = 0;
let nama = "";
let score = 0;
let spawn;
let audioCtx, osc;

const title = document.getElementById("title");
const text = document.getElementById("text");
const nameInput = document.getElementById("name");
const btn = document.getElementById("btn");
const game = document.getElementById("game");

btn.onclick = handleNext;

function handleNext(){

  if(step === 0){
    if(nameInput.value.trim() === ""){
      alert("Isi nama dulu ya ü§ç");
      return;
    }
    nama = nameInput.value.trim();
    nameInput.classList.add("hidden");
    title.innerHTML = Hai ${nama} ü§ç;
    text.innerHTML = "Tenang‚Ä¶ ini cuma iseng kok üòå";
    step = 1;
    return;
  }

  if(step === 1){
    text.innerHTML = "Klik ü§ç sebanyak mungkin.<br>Hindari üòà ya.";
    btn.innerText = "Mulai";
    step = 2;
    return;
  }

  if(step === 2){
    btn.classList.add("hidden");
    startGame();
    step = 3;
    return;
  }

  if(step === 4){
    location.reload();
  }
}

function startGame(){
  score = 0;
  game.innerHTML = "";
  game.classList.remove("hidden");

  spawn = setInterval(()=>{
    const el = document.createElement("div");
    const good = Math.random() > 0.3;
    el.className = "item";
    el.innerHTML = good ? "ü§ç" : "üòà";
    el.style.left = Math.random()*90 + "%";
    el.style.animationDuration = (3+Math.random()*2)+"s";

    el.onclick = ()=>{
      score += good ? 1 : -1;
      el.remove();
    };

    game.appendChild(el);
    setTimeout(()=>el.remove(),5000);
  },600);

  setTimeout(endGame, 20000);
}

function endGame(){
  clearInterval(spawn);
  game.classList.add("hidden");
  btn.classList.remove("hidden");
  btn.innerText = "Main Lagi";
  step = 4;

  text.innerHTML =
    score < 6 ? "Gapapa ü§ç yang penting ketawa dikit." :
    score < 12 ? "Nah kan‚Ä¶ senyum üòÜ" :
    "Tuh lihat üòå adek harus kuat yaaa.";

  title.innerHTML = "Makasih ya, ${nama}";
}

function toggleMusic(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    osc = audioCtx.createOscillator();
    osc.type = "sine";
    osc.frequency.value = 220;
    osc.connect(audioCtx.destination);
    osc.start();
  }else if(audioCtx.state === "running"){
    audioCtx.suspend();
  }else{
    audioCtx.resume();
  }
}

setInterval(()=>{
  const h = document.createElement("div");
  h.className = "float";
  h.innerHTML = "ü§ç";
  h.style.left = Math.random()*100 + "vw";
  h.style.animationDuration = (5+Math.random()*4)+"s";
  document.body.appendChild(h);
  setTimeout(()=>h.remove(),9000);
},700);
</script>
